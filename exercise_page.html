<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/styles.css" />
        <title>GymBuddy</title>
    </head>
    <script>
        // Constants received from the server-side template
        const setsStr = "{{ .Sets }}";
        const restTimeStr = "{{ .Rest }}";

        // Define some templates too
        const statusTextTmpl = (text, value) => {
            return `${text}: <code class="code">${value}</code>`;
        };

        // Normalize to integers
        var sets = parseInt(setsStr, 10);
        const restTime = parseInt(restTimeStr, 10);

        // And then normal js code
        var currentSet = 1;
        var remainingSets = sets + 1 - currentSet;

        document.addEventListener("DOMContentLoaded", () => {
            currentSetText = document.getElementById("current-set");
            remainingSetsText = document.getElementById("remaining-sets");
            startSetBtn = document.getElementById("start-button");

            currentSetText.innerHTML = statusTextTmpl(
                "Current Set",
                currentSet,
            );
            remainingSetsText.innerHTML = statusTextTmpl(
                "Remaining Sets",
                remainingSets,
            );
            startSetBtn.textContent = `Done with set ${currentSet}`;
            startSetBtn.disabled = false;

            startSetBtn.addEventListener("click", () => {
                currentSet += 1;
                remainingSets = sets - currentSet + 1;

                startSetBtn.disabled = true;

                if (currentSet > sets) {
                    startSetBtn.textContent = "Exercise complete!";
                    return;
                }

                currentSetText.innerHTML = statusTextTmpl(
                    "Current Set",
                    currentSet,
                );

                remainingSetsText.innerHTML = statusTextTmpl(
                    "Remaining Sets",
                    remainingSets - 1,
                );

                var repRestTime = restTime;

                const time = setInterval(() => {
                    repRestTime -= 1;
                    if (repRestTime <= 0) {
                        clearInterval(time);
                        startSetBtn.disabled = false;
                        startSetBtn.textContent = `Done with set ${currentSet}`;
                        return;
                    }
                    startSetBtn.textContent = `Rest for ${repRestTime}s`;
                }, 1000);
            });
        });
    </script>
    <body>
        <header class="header">
            <h1 class="header-title">GymBuddy</h1>
            <p class="header-subtitle">Your personal workout companion.</p>
        </header>
        <div class="content">
            <h2 class="content-title">Let's start</h2>
            <p class="content-subtitle">
                You have selected the
                <code class="code">{{ .Name }}</code> exercise.
            </p>
            <div class="separator"></div>
            <div class="exercise-details">
                <p class="exercise-detail">
                    Sets: <code class="code">{{ .Sets }}</code>
                </p>
                <p class="exercise-detail">
                    Repetitions: <code class="code">{{ .Reps }}</code>
                </p>
                <p class="exercise-detail">
                    Rest Time: <code class="code">{{ .Rest }}</code> seconds
                </p>
            </div>
            <div class="separator"></div>
            <div class="exercise-status">
                <div class="exercise-status-text">
                    <p id="current-set" class="exercise-detail">
                        Current Set: <code class="code">Loading...</code>
                    </p>
                    <p id="remaining-sets" class="exercise-detail">
                        Remaining Sets: <code class="code">Loading...</code>
                    </p>
                </div>
                <div class="exercise-status-buttons">
                    <button
                        id="start-button"
                        class="button button-primary"
                        disabled
                    >
                        Loading...
                    </button>
                    <button
                        onclick="history.back()"
                        class="button button-danger"
                    >
                        Back
                    </button>
                </div>
            </div>
        </div>
        <footer class="footer">
            <p class="footer-text">
                Make me better on <a class="footer-link">GitHub</a>.
            </p>
        </footer>
    </body>
</html>
